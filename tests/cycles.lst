mads 2.1.7
Source: cycles.s
     1 				;
     2 				; Test number of cycles per instruction
     3 				; by Ivo van Poorten
     4 				;
     5
     6 				.ifndef ATARI
     7 				    opt h-
     8 				    opt f+
     9 				    org 0
    10 0000 00			    dta 0
    11 				.endif
    12
    13 0001			    org $80
    14
    15 0080 12 80 56 78		    dta $12, $80, $56, $78
    16
    17 0084			    org $90
    18 0090 F0 1F		    dta a($1ff0)
    19
    20 0092			    org $2000
    21
    22 2000			main:
    23
    24 				    ; INIT
    25
    26 				.ifdef ATARI
    27 				    sei
    28 				    mva #0 $d20e
    29 				    sta $d40e
    30 				    mva #$fe $d301
    31 				    mwa #nmi $fffa
    32 				    mwa #irq $fffe
    33 				.endif
    34 2000 A2 00		    ldx #0      ; init to zero
    35 2002 A0 00		    ldy #0
    36 2004 D8			    cld
    37 2005 B8			    clv
    38 2006 4C 00 30		    jmp timing
    39
    40 2009			nmi:
    41 2009			irq:
    42 2009 40			    rti         ; $40 [6]
    43
    44 200A			endless:
    45 200A 4C 0A 20		    jmp *       ;     [3]
    46
    47 200D			subrout:
    48 200D 60			    rts         ;     [6];
    49
    50 200E			tramp:
    51 200E 36 33		    dta a(land_here)
    52
    53 2010			    org $3000
    54
    55 3000			timing:
    56 				                ; $00-$0f, documented opcodes --------------------------------
    57
    58 3000 00 00		    dta 0,0     ; $00 [7] brk is a two byte instruction!
    59 				                ;     [6] rti
    60 3002 01 80		    ora ($80,x) ; $01 [6]
    61 3004 05 80		    ora $80     ; $05 [3]
    62 3006 06 80		    asl $80     ; $06 [5]
    63 3008 08			    php         ; $08 [3]
    64 3009 09 FF		    ora #$ff    ; $09 [2] ...
    65 300B 0A			    asl         ; $0a [2]
    66 300C 0D 00 10		    ora $1000   ; $0d [4]
    67 300F 0E 00 10		    asl $1000   ; $0e [6]
    68
    69 				                ; $10-$1f, documented opcodes --------------------------------
    70
    71 3012 A2 FF		    ldx #-1     ;     [2] init for branch
    72 3014 10 00		    bpl @+      ; $10 [2] not taken
    73 				@:
    74 3016 A2 00		    ldx #0      ;     [2]
    75 3018 10 76		    bpl @+      ; $10 [3] taken
    76 301A EA EA EA EA EA EA +     .align $3090,$ea
    77 				@:
    78 3090 10 6E		    bpl @+      ; $10 [4] taken, page cross
    79 3092 EA EA EA EA EA EA +     .align $3100,$ea
    80 				@:
    81 3100 A0 00		    ldy #0      ;     [2]
    82 3102 11 90		    ora ($90),y ; $11 [5]
    83 3104 88			    dey         ;     [2]
    84 3105 11 90		    ora ($90),y ; $11 [6]
    85 3107 15 80		    ora $80,x   ; $15 [4]
    86 3109 16 80		    asl $80,x   ; $16 [6]
    87 310B 18			    clc         ; $18 [2]
    88 310C 19 00 10		    ora $1000,y ; $19 [4]
    89 310F 19 80 10		    ora $1080,y ; $19 [5]
    90 3112 CA			    dex         ;     [2]
    91 3113 1D 00 10		    ora $1000,x ; $1d [4]
    92 3116 1D 80 10		    ora $1080,x ; $1d [5]
    93 3119 1E 00 10		    asl $1000,x ; $1e [7]
    94
    95 				                ; $20-$2f, documented opcodes --------------------------------
    96
    97 311C 20 0D 20		    jsr subrout ; $20 [6]
    98 				                ;     [6] rts
    99 311F 21 80		    and ($80,x) ; $21 [6]
   100 3121 24 80		    bit $80     ; $24 [3]
   101 3123 25 80		    and $80     ; $25 [3]
   102 3125 26 80		    rol $80     ; $26 [5]
   103 3127 28			    plp         ; $28 [4]
   104 3128 29 FF		    and #$ff    ; $29 [2]
   105 312A 2A			    rol         ; $2a [2]
   106 312B 2C 00 10		    bit $1000   ; $2c [4]
   107 312E 2D 00 10		    and $1000   ; $2d [4]
   108 3131 2E 00 10		    rol $1000   ; $2e [6]
   109
   110 				                ; $30-$3f, documented opcodes --------------------------------
   111
   112 3134 A2 00		    ldx #0      ;     [2]
   113 3136 30 00		    bmi @+      ; $30 [2] not taken
   114 				@:
   115 3138 A2 FF		    ldx #-1     ;     [2]
   116 313A 30 54		    bmi @+      ;     [3] taken
   117 313C EA EA EA EA EA EA +     .align $3190,$ea
   118 				@:
   119 3190 30 6E		    bmi @+      ;     [4] taken, page cross
   120 3192 EA EA EA EA EA EA +     .align $3200,$ea
   121 				@:
   122 3200 A0 00		    ldy #0      ;     [2]
   123 3202 31 90		    and ($90),y ; $31 [5]
   124 3204 88			    dey         ;     [2]
   125 3205 31 90		    and ($90),y ;     [6]
   126 3207 35 80		    and $80,x   ; $35 [4]
   127 3209 36 80		    rol $80,x   ; $36 [6]
   128 320B 38			    sec         ; $38 [2]
   129 320C 39 00 10		    and $1000,y ; $39 [4]
   130 320F 39 80 10		    and $1080,y ; $39 [5]
   131 3212 3D 00 10		    and $1000,x ; $3a [4]
   132 3215 3D 80 10		    and $1080,x ; $3d [5]
   133 3218 3E 00 10		    rol $1000,x ; $3e [7]
   134
   135 				                ; $40-$4f, documented opcodes --------------------------------
   136
   137 				    ;rti        ; $40       skipped, already tested by brk
   138 321B 41 80		    eor ($80,x) ; $41 [6]
   139 321D 45 80		    eor $80     ; $45 [3]
   140 321F 46 80		    lsr $80     ; $46 [5]
   141 3221 48			    pha         ; $48 [3]
   142 3222 49 FF		    eor #$ff    ; $49 [2]
   143 3224 4A			    lsr         ; $4a [2]
   144 3225 4C 28 32		    jmp next    ; $4c [3]
   145 3228			next:
   146 3228 4D 00 10		    eor $1000   ; $4d [4]
   147 322B 4E 00 10		    lsr $1000   ; $4e [6]
   148
   149 				                ; $50-$5f, documented opcodes --------------------------------
   150
   151 322E A9 40		    lda #$40    ;     [2] set V
   152 3230 48			    pha         ;     [3]
   153 3231 28			    plp         ;     [4]
   154 3232 50 00		    bvc @+      ; $50 [2] not taken
   155 				@:
   156 3234 B8			    clv         ;     [2]
   157 3235 50 59		    bvc @+      ; $50 [3] taken
   158 3237 EA EA EA EA EA EA +     .align $3290, $ea
   159 				@:
   160 3290 50 6E		    bvc @+      ; $50 [4] taken, page cross
   161 3292 EA EA EA EA EA EA +     .align $3300, $ea
   162 				@:
   163 3300 A0 00		    ldy #0      ;     [2]
   164 3302 51 90		    eor ($90),y ; $51 [5]
   165 3304 88			    dey         ;     [2]
   166 3305 51 90		    eor ($90),y ; $51 [6]
   167 3307 55 80		    eor $80,x   ; $55 [4]
   168 3309 56 80		    lsr $80,x   ; $56 [6]
   169 330B 58			    cli         ; $58 [2]
   170 330C 59 00 10		    eor $1000,y ; $59 [4]
   171 330F 59 80 10		    eor $1080,y ; $59 [5]
   172 3312 5D 00 10		    eor $1000,x ; $5d [4]
   173 3315 5D 80 10		    eor $1080,x ; $5d [5]
   174 3318 5E 00 10		    lsr $1000,x ; $5e [7]
   175
   176 				                ; $60-$6f, documented opcodes --------------------------------
   177
   178 				    ;rts        ; $60     skipped, already tested by jsr
   179 331B D8			    cld         ;     [2]
   180 331C 61 80		    adc ($80,x) ; $61 [6]
   181 331E 65 80		    adc $80     ; $65 [3]
   182 3320 69 FF		    adc #$ff    ; $69 [2]
   183 3322 6D 00 10		    adc $1000   ; $6d [4]
   184
   185 3325 F8			    sed         ;     [2]   adc +1 cycle in decimal mode
   186 3326 61 80		    adc ($80,x) ; $61 [7]
   187 3328 65 80		    adc $80     ; $65 [4]
   188 332A 69 FF		    adc #$ff    ; $69 [3]
   189 332C 6D 00 10		    adc $1000   ; $6d [5]
   190
   191 332F 66 80		    ror $80     ; $66 [5]
   192 3331 68			    pla         ; $68 [4]
   193 3332 6A			    ror         ; $6a [2]
   194 3333 6C 0E 20		    jmp (tramp) ; $6c [5]
   195 3336			land_here:
   196 3336 6E 00 10		    ror $1000   ; $6e [6]
   197
   198 				                ; $70-$7f, documented opcodes --------------------------------
   199
   200 3339 B8			    clv         ;     [2]
   201 333A 70 00		    bvs @+      ; $70 [2] not taken
   202 				@:
   203 333C A9 40		    lda #$40    ;     [2] set V
   204 333E 48			    pha         ;     [3]
   205 333F 28			    plp         ;     [4]
   206 3340 70 4E		    bvs @+      ; $70 [3] taken
   207 3342 EA EA EA EA EA EA +     .align $3390,$ea
   208 				@:
   209 3390 70 6E		    bvs @+      ; $70 [4] taken, page cross
   210 3392 EA EA EA EA EA EA +     .align $3400,$ea
   211 				@:
   212 3400 D8			    cld         ;     [2]
   213 3401 A0 00		    ldy #0      ;     [2]
   214 3403 71 90		    adc ($90),y ; $71 [5]
   215 3405 88			    dey         ;     [2]
   216 3406 71 90		    adc ($90),y ; $71 [6]
   217 3408 75 80		    adc $80,x   ; $75 [4]
   218 340A 79 00 10		    adc $1000,y ; $79 [4]
   219 340D 79 80 10		    adc $1080,y ; $79 [5]
   220 3410 7D 00 10		    adc $1000,x ; $7d [4]
   221 3413 7D 80 10		    adc $1080,x ; $7d [5]
   222
   223 3416 F8			    sed         ;     [2]   decimal mode, same as above, +1
   224 3417 A0 00		    ldy #0      ;     [2]
   225 3419 71 90		    adc ($90),y ; $71 [6]
   226 341B 88			    dey         ;     [2]
   227 341C 71 90		    adc ($90),y ; $71 [7]
   228 341E 75 80		    adc $80,x   ; $75 [5]
   229 3420 79 00 10		    adc $1000,y ; $79 [5]
   230 3423 79 80 10		    adc $1080,y ; $79 [6]
   231 3426 7D 00 10		    adc $1000,x ; $7d [5]
   232 3429 7D 80 10		    adc $1080,x ; $7d [6]
   233
   234 342C 76 80		    ror $80,x   ; $76 [6]
   235 342E 78			    sei         ; $78 [2]
   236 342F 7E 00 10		    ror $1000,x ; $7e [7]
   237
   238 				                ; $80-$8f, documented opcodes --------------------------------
   239
   240 3432 A2 00		    ldx #0      ;     [2]
   241 3434 81 80		    sta ($80,x) ; $81 [6]
   242 3436 84 A0		    sty $a0     ; $84 [3]
   243 3438 85 A0		    sta $a0     ; $85 [3]
   244 343A 86 A0		    stx $a0     ; $86 [3]
   245 343C 88			    dey         ; $88 [2]
   246 343D 8A			    txa         ; $8a [2]
   247 343E 8C 00 10		    sty $1000   ; $8c [4]
   248 3441 8D 00 10		    sta $1000   ; $8d [4]
   249 3444 8E 00 10		    stx $1000   ; $8e [4]
   250
   251 				                ; $90-$9f, documented opcodes --------------------------------
   252
   253 3447 38			    sec         ;     [2]
   254 3448 90 00		    bcc @+      ; $90 [2] not taken
   255 				@:
   256 344A 18			    clc         ;     [2]
   257 344B 90 43		    bcc @+      ; $90 [3] taken
   258 344D EA EA EA EA EA EA +     .align $3490,$ea
   259 				@:
   260 3490 90 6E		    bcc @+      ; $90 [4] taken, page cross
   261 3492 EA EA EA EA EA EA +     .align $3500,$ea
   262 				@:
   263 3500 A0 00		    ldy #0      ;     [2]
   264 3502 91 80		    sta ($80),y ; $91 [6] no page cross
   265 3504 88			    dey         ;     [2]
   266 3505 84 80		    sty $80     ;     [3]
   267 3507 91 80		    sta ($80),y ; $91 [6] page cross, but still 6(!)
   268 3509 A2 00		    ldx #0      ;     [2]
   269 350B 94 80		    sty $80,x   ; $94 [4]
   270 350D 95 80		    sta $80,x   ; $95 [4]
   271 350F 96 80		    stx $80,y   ; $96 [4]
   272 3511 98			    tya         ; $98 [2]
   273 3512 99 00 10		    sta $1000,y ; $99 [5]
   274 3515 99 FF 10		    sta $10ff,y ; $99 [5]
   275 3518 9A			    txs         ; $9a [2]
   276 3519 9D 00 10		    sta $1000,x ; $9d [5]
   277 351C 9D FF 10		    sta $10ff,x ; $9d [5]
   278
   279 				                ; $a0-$af, documented opcodes --------------------------------
   280
   281 351F A0 00		    ldy #0      ; $a0 [2]
   282 3521 A1 80		    lda ($80,x) ; $a1 [6]
   283 3523 A2 00		    ldx #0      ; $a2 [2]
   284 3525 A4 80		    ldy $80     ; $a4 [3]
   285 3527 A5 80		    lda $80     ; $a5 [3]
   286 3529 A6 80		    ldx $80     ; $a6 [3]
   287 352B A8			    tay         ; $a8 [2]
   288 352C A9 00		    lda #0      ; $a9 [2]
   289 352E AA			    tax         ; $aa [2]
   290 352F AC 00 10		    ldy $1000   ; $ac [4]
   291 3532 AD 00 10		    lda $1000   ; $ad [4]
   292 3535 AE 00 10		    ldx $1000   ; $ae [4]
   293
   294 				                ; $b0-$bf, documented opcodes --------------------------------
   295
   296 3538 18			    clc         ;     [2]
   297 3539 B0 00		    bcs @+      ; $b0 [2] not taken
   298 				@:
   299 353B 38			    sec         ;     [2]
   300 353C B0 52		    bcs @+      ; $b0 [3] taken
   301 353E EA EA EA EA EA EA +     .align $3590,$ea
   302 				@:
   303 3590 B0 6E		    bcs @+      ; $b0 [4] taken, page cross
   304 3592 EA EA EA EA EA EA +     .align $3600,$ea
   305 				@:
   306 3600 A0 00		    ldy #0      ;     [2]
   307 3602 B1 90		    lda ($90),y ; $b1 [5]
   308 3604 88			    dey         ;     [2]
   309 3605 B1 90		    lda ($90),y ; $b1 [6]
   310 3607 B4 80		    ldy $80,x   ; $b4 [4]
   311 3609 B5 80		    lda $80,x   ; $b5 [4]
   312 360B B6 80		    ldx $80,y   ; $b6 [4]
   313 360D B8			    clv         ; $b8 [2]
   314 360E A0 FF		    ldy #$ff    ;     [2]
   315 3610 B9 00 10		    lda $1000,y ; $b9 [4]
   316 3613 B9 80 10		    lda $1080,y ; $b9 [5]
   317 3616 BA			    tsx         ; $ba [2]
   318 3617 A2 FF		    ldx #$ff    ;     [2]
   319 3619 BC 00 10		    ldy $1000,x ; $bc [4]
   320 361C BC 01 10		    ldy $1001,x ; $bc [5]
   321 361F BD 00 10		    lda $1000,x ; $bd [4]
   322 3622 BD 01 10		    lda $1001,x ; $bd [5]
   323 3625 BE 00 10		    ldx $1000,y ; $be [4]
   324 3628 B9 01 10		    lda $1001,y ; $be [5]
   325
   326 362B 4C 0A 20		    jmp endless ;     [3]
   327
   328 				.ifndef ATARI
   329 362E			    org $fffa
   330 FFFA 09 20 00 20 09 20	    dta a(nmi),a(main),a(irq)
   331 				.else
   332 				    run main
   333 				.endif
   334
   335 				    .print "endless = ",endless
   335 				endless = $200A
   336
